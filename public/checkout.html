<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout – Mrucha Beauty</title>
<link href="https://fonts.googleapis.com/css2?family=Asul:wght@400;700&display=swap" rel="stylesheet">
<style>
body {font-family:'Asul', serif; margin:0; background:#faf7f5; color:#333;}
header {background:#fff; padding:14px; border-bottom:1px solid #eee; font-weight:bold; color:#b30000; text-align:center;}

.checkout-container {display:flex; flex-wrap:wrap; justify-content:center; gap:20px; max-width:1200px; margin:20px auto;}

.checkout-form {flex:1; min-width:600px; max-width:600px; background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05);}
.checkout-form h2 {color:#b30000; margin-top:20px;}
.checkout-form label {display:block; margin-top:10px; font-weight:bold; color:#7b2d00;}
.checkout-form input, .checkout-form select, .checkout-form textarea {width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; margin-top:5px;}

.payment-methods {background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05); margin-top:20px; text-align:left;}
.payment-methods h3 {margin-bottom:10px;}
.payment-btn {display:flex; align-items:center; gap:10px; padding:12px; border:1px solid #ccc; border-radius:8px; cursor:pointer; margin-bottom:10px; background:#fafafa;}
.payment-btn.selected {border-color:#b30000; background:#ffeaea;}
.payment-btn img {width:40px; height:auto;}

.payment-input {display:none; margin-top:10px;}
.payment-input input {width:100%; padding:8px; border-radius:6px; border:1px solid #ccc;}

.order-summary {flex:0 0 200px; min-width:600px; max-width:600px; background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05);}
.order-summary h2 {color:#b30000; margin-bottom:10px;}
.order-item {display:flex; justify-content:space-between; margin-bottom:10px;}
.order-item-details {flex:1;}

.place-order-btn {background:#b30000; color:white; padding:14px; width:100%; border:none; border-radius:50px; font-weight:bold; cursor:pointer; margin-top:20px;}
.place-order-btn:hover {background:#a00000;}

.popup-success {position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; border-radius:16px; padding:30px; text-align:center; box-shadow:0 8px 20px rgba(0,0,0,0.2); display:none; z-index:1000;}
.popup-success img {width:60px; height:60px;}
.popup-success h3 {color:#2e7d32; margin:10px 0;}

@media(max-width:900px) { .checkout-container {flex-direction:column; align-items:center;} }
</style>
</head>
<body>

<header>Checkout – Mrucha Beauty</header>

<div class="checkout-container">
  <div class="checkout-form">
    <h2>Contact</h2>
    <label>First Name</label><input type="text" id="firstName" required>
    <label>Last Name</label><input type="text" id="lastName" required>
    <label>Email Address</label><input type="email" id="email" required>

    <h2>Delivery Address</h2>
    <label>Country</label><select id="country"><option value="IN">India</option></select>
    <label>State</label><select id="state"><option value="MH">Maharashtra</option></select>
    <label>City</label><input type="text" id="city" required>
    <label>PIN Code</label><input type="text" id="pin" required>
    <label>Phone Number</label><input type="tel" id="phone" required>

    <h2>Payment</h2>
    <div class="payment-methods">
      <h3>Select Payment Method</h3>
      <div class="payment-btn" data-method="card">
        <img src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1/assets/visa.sxIq5Dot.svg" alt="Visa">
        <img src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1/assets/master.CzeoQWmc.svg" alt="MasterCard">
        <span>Card</span>
      </div>
      <div class="payment-btn" data-method="upi">
        <img src="https://cdn.shopify.com/shopifycloud/checkout-web/assets/c1/assets/upi.CmgCfll8.svg" alt="UPI">
        <span>UPI</span>
      </div>
      <div class="payment-btn" data-method="cod"><span>Cash on Delivery</span></div>

      <div class="payment-input" id="payment-input">
        <label id="payment-label"></label>
        <input type="text" id="payment-value" placeholder="">
      </div>
    </div>

    <button class="place-order-btn" onclick="placeOrder()">Place Order</button>
  </div>

  <div class="order-summary">
    <h2>Order Summary</h2>
    <div id="order-summary"></div>
  </div>
</div>

<div class="popup-success" id="success-popup">
  <img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Success">
  <h3>Order Successful!</h3>
  <p>Thank you for shopping with Mrucha Beauty.</p>
</div>

<script>
// Cart simulation
const cart = JSON.parse(localStorage.getItem('cart')) || [];
const summaryDiv = document.getElementById('order-summary');
let selectedPayment = 'cod';

// Render order summary (name + price)
function renderCart(){
  if(cart.length===0){ summaryDiv.innerHTML="<p>Your cart is empty.</p>"; return; }
  summaryDiv.innerHTML = cart.map(p=>`<div class="order-item"><div>${p.name}</div><div>₹${p.price}</div></div>`).join('')+
    `<hr><p><strong>Total: ₹${cart.reduce((t,p)=>t+p.price,0)}</strong></p>`;
}
renderCart();

// Payment selection
document.querySelectorAll('.payment-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.payment-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedPayment = btn.dataset.method;
    const inputDiv = document.getElementById('payment-input');
    const label = document.getElementById('payment-label');
    const value = document.getElementById('payment-value');

    if(selectedPayment==='card'){ inputDiv.style.display='block'; label.innerText='Card Number'; value.placeholder='XXXX-XXXX-XXXX-XXXX'; }
    else if(selectedPayment==='upi'){ inputDiv.style.display='block'; label.innerText='UPI ID'; value.placeholder='example@upi'; }
    else{ inputDiv.style.display='none'; value.value=''; }
  });
});

// Place order
async function placeOrder(){
  const firstName=document.getElementById('firstName').value.trim();
  const lastName=document.getElementById('lastName').value.trim();
  const email=document.getElementById('email').value.trim();
  const country=document.getElementById('country').value;
  const state=document.getElementById('state').value;
  const city=document.getElementById('city').value.trim();
  const pin=document.getElementById('pin').value.trim();
  const phone=document.getElementById('phone').value.trim();
  const paymentDetails=document.getElementById('payment-value').value.trim();

  if(!firstName||!lastName||!email||!city||!pin||!phone){ alert("Please fill all details"); return; }
  if((selectedPayment==='card'||selectedPayment==='upi')&&!paymentDetails){ alert("Enter payment info"); return; }

  try{
    const res=await fetch("http://localhost:5000/order",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({firstName,lastName,email,country,state,city,pin,phone,cart,total:cart.reduce((t,p)=>t+p.price,0),paymentMethod:selectedPayment,paymentDetails})
    });
    const data=await res.json();
    if(res.ok){ document.getElementById('success-popup').style.display='block'; localStorage.removeItem('cart'); setTimeout(()=>window.location.href='home.html',3000);}
    else{ alert(data.message||"Something went wrong"); }
  }catch(err){ console.error(err); alert("Failed to place order"); }
}
</script>

</body>
</html>
